<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <meta charset="utf-8" />
    <title>Client Questionnaire</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container mt-5 mb-5">
      <div class="card shadow">
        <div class="card-body">
          <h3 class="text-center">CLIENT QUESTIONNAIRE</h3>
          <p class="text-center mb-4">(for Company Registration & KYC)</p>

          <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
          <form id="questionnaire-form">
            <h5>1. PERSONAL INFORMATION</h5>
            <div class="mb-3">
              <label class="form-label">Full name (as in passport):</label>
              <input
                type="text"
                class="form-control"
                name="fullName"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Nationality:</label>
              <input
                type="text"
                class="form-control"
                name="nationality"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Date of birth:</label>
              <input type="date" class="form-control" name="dob" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Place of birth (City, Country):</label>
              <input
                type="text"
                class="form-control"
                name="birthPlace"
                required
              />
            </div>

            <div class="mb-3">
              <label class="form-label">Do you have E-residency?</label>
              <select
                class="form-select"
                name="hasEResidency"
                id="hasEResidency"
                required
              >
                <option value="">Select...</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>

            <div id="if-no-eresidency" class="hidden">
              <div class="mb-3">
                <label class="form-label"
                  >Personal ID code / Passport number:</label
                >
                <input type="text" class="form-control" name="passportNumber" />
              </div>
              <div class="mb-3">
                <label class="form-label">Date of issue / Expiry date:</label>
                <input type="date" class="form-control" name="passportExpiry" />
              </div>
            </div>

            <div id="if-yes-eresidency" class="hidden">
              <div class="mb-3">
                <label class="form-label"
                  >E-residency card number (Estonian ID):</label
                >
                <input type="text" class="form-control" name="eresidencyID" />
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Residential address:</label>
              <textarea
                class="form-control"
                name="residentialAddress"
                required
              ></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Email address:</label>
              <input type="email" class="form-control" name="email" required />
            </div>
            <div class="mb-3">
              <label class="form-label"
                >Phone number (incl. country code):</label
              >
              <input type="tel" class="form-control" name="phone" />
            </div>

            <h5 class="mt-4">2. OCCUPATION & BACKGROUND</h5>
            <div class="mb-3">
              <label class="form-label">Current occupation / job title:</label>
              <input
                type="text"
                class="form-control"
                name="occupation"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Company name:</label>
              <input type="text" class="form-control" name="companyName" />
            </div>
            <div class="mb-3">
              <label class="form-label"
                >Brief description of your professional background:</label
              >
              <textarea
                class="form-control"
                name="background"
                required
              ></textarea>
            </div>

            <h5 class="mt-4">3. COMPANY INFORMATION</h5>
            <div class="mb-3">
              <label class="form-label"
                >Proposed company name (1‚Äì3 variants):</label
              >
              <textarea
                class="form-control"
                name="companyNames"
                required
              ></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Company e-mail address:</label>
              <input
                type="email"
                class="form-control"
                name="companyEmail"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Planned business activities:</label>
              <textarea
                class="form-control"
                name="businessActivities"
                required
              ></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label"
                >Country(-ies) of your customers/clients:</label
              >
              <input
                type="text"
                class="form-control"
                name="customerCountries"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label"
                >Will you have clients or partners from the EU?</label
              >
              <select class="form-select" name="hasEUClients" required>
                <option value="">Select...</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Expected annual turnover (EUR):</label>
              <input
                type="number"
                class="form-control"
                name="annualTurnover"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label"
                >Expected monthly number of invoices:</label
              >
              <input
                type="number"
                class="form-control"
                name="monthlyInvoices"
                required
              />
            </div>

            <h5 class="mt-4">4. OWNERSHIP & MANAGEMENT</h5>
            <div class="mb-3">
              <label class="form-label"
                >Will you be the sole shareholder and director?</label
              >
              <select
                class="form-select"
                name="soleOwner"
                id="soleOwner"
                required
              >
                <option value="">Select...</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
            <div class="mb-3 hidden" id="otherOwners">
              <label class="form-label"
                >If not, please provide details of other
                shareholders/directors:</label
              >
              <textarea
                class="form-control"
                name="otherShareholders"
              ></textarea>
            </div>

            <h5 class="mt-4">5. COMPLIANCE & KYC</h5>
            <div class="mb-3">
              <label class="form-label">Source of funds:</label>
              <input
                type="text"
                class="form-control"
                name="sourceOfFunds"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label"
                >Purpose of setting up the company in Estonia:</label
              >
              <textarea class="form-control" name="purpose" required></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label"
                >Do you or any associated person hold a political position
                (PEP)?</label
              >
              <select class="form-select" name="isPEP" required>
                <option value="">Select...</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label"
                >Are you or any related party under international
                sanctions?</label
              >
              <select class="form-select" name="sanctions" required>
                <option value="">Select...</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>

            <h5 class="mt-4">6. DOCUMENTS TO ATTACH</h5>
            <div class="mb-3">
              <label class="form-label">E-residency card (front side):</label>
              <input
                type="file"
                name="eresidencyCard"
                class="form-control"
                accept="image/*,application/pdf"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Passport or national ID:</label>
              <input
                type="file"
                name="passportScan"
                class="form-control"
                accept="image/*,application/pdf"
                required
              />
            </div>

            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-warning">Submit</button>
            </div>
            <div id="success-msg" class="alert alert-success mt-3 d-none">
              Form submitted successfully!
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById("questionnaire-form");
      const submitBtn = form.querySelector('button[type="submit"]');
      const spinner = document.createElement("div");
      spinner.className = "spinner-border text-warning ms-2";
      spinner.setAttribute("role", "status");
      spinner.innerHTML = '<span class="visually-hidden">Loading...</span>';

      document
        .getElementById("hasEResidency")
        .addEventListener("change", function () {
          document
            .getElementById("if-yes-eresidency")
            .classList.toggle("hidden", this.value !== "Yes");
          document
            .getElementById("if-no-eresidency")
            .classList.toggle("hidden", this.value !== "No");
        });

      document
        .getElementById("soleOwner")
        .addEventListener("change", function () {
          document
            .getElementById("otherOwners")
            .classList.toggle("hidden", this.value !== "No");
        });

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        // üîí Disable button + show spinner
        submitBtn.disabled = true;
        submitBtn.appendChild(spinner);

        const data = {};
        const elements = form.querySelectorAll("input, select, textarea");
        elements.forEach((el) => {
          if (el.type !== "file") {
            data[el.name] = el.value;
          }
        });

        const fileInputs = form.querySelectorAll('input[type="file"]');
        let filesToRead = fileInputs.length;
        const base64Files = [];

        if (filesToRead === 0) {
          finishSubmission(); // –µ—Å–ª–∏ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤
          return;
        }

        fileInputs.forEach((input) => {
          const file = input.files[0];
          if (!file) {
            filesToRead--;
            if (filesToRead === 0) finishSubmission();
            return;
          }

          const reader = new FileReader();
          reader.onload = function (e) {
            const base64 = e.target.result.split(",")[1];
            base64Files.push({
              filename: file.name,
              mimeType: file.type,
              content: base64,
            });
            filesToRead--;
            if (filesToRead === 0) finishSubmission();
          };
          reader.readAsDataURL(file);
        });

        function finishSubmission() {
          // ‚úÖ 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–Ω–∫–µ—Ç—É, —Å–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É, –ø–æ–ª—É—á–∞–µ–º folderId
          google.script.run
            .withSuccessHandler(function (folderId) {
              // ‚úÖ 2. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã
              google.script.run
                .withSuccessHandler(() => {
                  // ‚úÖ 3. –í—Å—ë –≥–æ—Ç–æ–≤–æ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
                  document
                    .getElementById("success-msg")
                    .classList.remove("d-none");
                  form.reset();
                  spinner.remove();
                  submitBtn.disabled = false;
                })
                .uploadFiles(folderId, base64Files);
            })
            .submitForm(data);
        }
      });
    </script>
  </body>
</html>
